{"ast":null,"code":"/** PURE_IMPORTS_START tslib,_Subject,_Observable,_Subscriber,_Subscription,_operators_refCount PURE_IMPORTS_END */\nimport * as tslib_1 from \"tslib\";\nimport { SubjectSubscriber } from '../Subject';\nimport { Observable } from '../Observable';\nimport { Subscriber } from '../Subscriber';\nimport { Subscription } from '../Subscription';\nimport { refCount as higherOrderRefCount } from '../operators/refCount';\n\nvar ConnectableObservable = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(ConnectableObservable, _super);\n\n  function ConnectableObservable(source, subjectFactory) {\n    var _this = _super.call(this) || this;\n\n    _this.source = source;\n    _this.subjectFactory = subjectFactory;\n    _this._refCount = 0;\n    _this._isComplete = false;\n    return _this;\n  }\n\n  ConnectableObservable.prototype._subscribe = function (subscriber) {\n    return this.getSubject().subscribe(subscriber);\n  };\n\n  ConnectableObservable.prototype.getSubject = function () {\n    var subject = this._subject;\n\n    if (!subject || subject.isStopped) {\n      this._subject = this.subjectFactory();\n    }\n\n    return this._subject;\n  };\n\n  ConnectableObservable.prototype.connect = function () {\n    var connection = this._connection;\n\n    if (!connection) {\n      this._isComplete = false;\n      connection = this._connection = new Subscription();\n      connection.add(this.source.subscribe(new ConnectableSubscriber(this.getSubject(), this)));\n\n      if (connection.closed) {\n        this._connection = null;\n        connection = Subscription.EMPTY;\n      }\n    }\n\n    return connection;\n  };\n\n  ConnectableObservable.prototype.refCount = function () {\n    return higherOrderRefCount()(this);\n  };\n\n  return ConnectableObservable;\n}(Observable);\n\nexport { ConnectableObservable };\nexport var connectableObservableDescriptor = /*@__PURE__*/function () {\n  var connectableProto = ConnectableObservable.prototype;\n  return {\n    operator: {\n      value: null\n    },\n    _refCount: {\n      value: 0,\n      writable: true\n    },\n    _subject: {\n      value: null,\n      writable: true\n    },\n    _connection: {\n      value: null,\n      writable: true\n    },\n    _subscribe: {\n      value: connectableProto._subscribe\n    },\n    _isComplete: {\n      value: connectableProto._isComplete,\n      writable: true\n    },\n    getSubject: {\n      value: connectableProto.getSubject\n    },\n    connect: {\n      value: connectableProto.connect\n    },\n    refCount: {\n      value: connectableProto.refCount\n    }\n  };\n}();\n\nvar ConnectableSubscriber = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(ConnectableSubscriber, _super);\n\n  function ConnectableSubscriber(destination, connectable) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.connectable = connectable;\n    return _this;\n  }\n\n  ConnectableSubscriber.prototype._error = function (err) {\n    this._unsubscribe();\n\n    _super.prototype._error.call(this, err);\n  };\n\n  ConnectableSubscriber.prototype._complete = function () {\n    this.connectable._isComplete = true;\n\n    this._unsubscribe();\n\n    _super.prototype._complete.call(this);\n  };\n\n  ConnectableSubscriber.prototype._unsubscribe = function () {\n    var connectable = this.connectable;\n\n    if (connectable) {\n      this.connectable = null;\n      var connection = connectable._connection;\n      connectable._refCount = 0;\n      connectable._subject = null;\n      connectable._connection = null;\n\n      if (connection) {\n        connection.unsubscribe();\n      }\n    }\n  };\n\n  return ConnectableSubscriber;\n}(SubjectSubscriber);\n\nvar RefCountOperator = /*@__PURE__*/function () {\n  function RefCountOperator(connectable) {\n    this.connectable = connectable;\n  }\n\n  RefCountOperator.prototype.call = function (subscriber, source) {\n    var connectable = this.connectable;\n    connectable._refCount++;\n    var refCounter = new RefCountSubscriber(subscriber, connectable);\n    var subscription = source.subscribe(refCounter);\n\n    if (!refCounter.closed) {\n      refCounter.connection = connectable.connect();\n    }\n\n    return subscription;\n  };\n\n  return RefCountOperator;\n}();\n\nvar RefCountSubscriber = /*@__PURE__*/function (_super) {\n  tslib_1.__extends(RefCountSubscriber, _super);\n\n  function RefCountSubscriber(destination, connectable) {\n    var _this = _super.call(this, destination) || this;\n\n    _this.connectable = connectable;\n    return _this;\n  }\n\n  RefCountSubscriber.prototype._unsubscribe = function () {\n    var connectable = this.connectable;\n\n    if (!connectable) {\n      this.connection = null;\n      return;\n    }\n\n    this.connectable = null;\n    var refCount = connectable._refCount;\n\n    if (refCount <= 0) {\n      this.connection = null;\n      return;\n    }\n\n    connectable._refCount = refCount - 1;\n\n    if (refCount > 1) {\n      this.connection = null;\n      return;\n    }\n\n    var connection = this.connection;\n    var sharedConnection = connectable._connection;\n    this.connection = null;\n\n    if (sharedConnection && (!connection || sharedConnection === connection)) {\n      sharedConnection.unsubscribe();\n    }\n  };\n\n  return RefCountSubscriber;\n}(Subscriber);","map":{"version":3,"mappings":";AAAA,OAAO,KAAWA,OAAlB,MAAkB,OAAlB;AAEA,SAASC,iBAAT,QAA2B,YAA3B;AACA,SAASC,UAAT,QAA2B,eAA3B;AACA,SAASC,UAAT,QAAuB,eAAvB;AAEA,SAASC,YAAT,QAAqB,iBAArB;AAKA;;IAA8CC,+CAAaC,MAAb,EAAa;AAQzDN,2CACsBM,MADtB;;WAAAD,sBAEEE,QAAOC,gBACR;AAHkB,gBAAMF,MAAN,KAAM,CAAe,IAAf,KAAe,IAArB;;AACGG;AANZA,2BAAsBD,cAAtB;AAGVC,sBAAW,CAAX;;AAKC;AAGD;;uBACc,WAAaC,aAAU,UAAYC,UAAZ,EAAY;AAChD;AAES;;uBACQ,CAAIC,UAAUC;AAC9B,QAAIC,OAAC,GAAO,KAAIC,QAAhB;;QACE,YAAKD,OAAW,CAAIE,WAAC;AACtB;AACD;;AACD;AAED;;uBACmB,WAAKC,UAAY;AAClC,QAAIC,UAAC,GAAY,gBAAjB;;QACE,aAAK;AACL,yBAAkB,KAAlB;AACAA,gBAAU,GAAC,KAAIC,WAAJ,GAAe,kBAA1B;gBACG,KAAU,KAAIZ,MAAJ,CACTa,SADS,CACE,0BAAQ,iBAAR,EAAQ,IAAR,CADF;;UAEXF,UAAK,SAAc;AACnB,2BAAa,IAAb;AACDA;AACF;AACD;;AACD;AAED;;uBACS,WAAqBG,WAAwB;AACrD;AACH;;AA5C8C;CAAA;;AA8C9C,SAAOhB,qBAAP;OACE,IAAMiB,+BAAwB,gBAAgC;AAC9D,sBAAO,kCAAP;SACE;AACAC,cAAS;AAAEC,WAAE,EAAK;AAAT,KADT;AAEAC,aAAQ,EAAE;AAAED,WAAK,EAAE,CAAT;AAAqBE,cAAE,EAAQ;AAA/B,KAFV;AAGAX;AAAWS,WAAI,MAAf;AAAsBE,cAAc;AAApC,KAHA;AAIAP,eAAU,EAAE;AAAEK,WAAK,EAAE,IAAT;AAASE,gBAAiB;AAA1B,KAJZ;AAKAhB,gBAAW;AAAEc,WAAE,EAAKG,gBAAE,CAAgBjB;AAA3B,KALX;AAMAkB,eAAU,EAAE;AAAEJ,WAAK,EAAEG,gBAAiB,YAA1B;AAAsCD;AAAtC,KANZ;AAOAb,cAAS,EAAE;AAAAW,WAAO,kBAAiB;AAAxB,KAPX;AAQAP,aAAQ;AAAEO,WAAE,EAAKG,gBAAE,CAAgBV;AAA3B,KARR;AASAI;AAAAG;AAAA;AATA;AAYJ,CAdgE,EAA9D;;IAcqCK,+CAAoBvB,MAApB,EAAoB;AACzDN,2CAAYM,MAAZ;;WAAAuB,sBAEEC,aAAMC,aACP;AAFmB,sBAAW,KAAX,uBAAqC,IAArC;;;AAEnB;AACS;;uBACS,WAAGC;AACpB;;AACD1B;AACS;;uBACS,WAAW2B,YAAQ;AACpC,SAAKF,WAAL,CAAiBH,WAAjB,GAAoB,IAApB;;AACA;;AACDtB;AACS;;uBACS,CAAQM,UAAKsB,eAAY;AAC1C,QAAIH,WAAW,GAAE,gBAAjB;;QACEA,aAAK;AACL,WAAMA,WAAN,GAAmB,IAAnB;AACA,oBAAY,cAAc,YAA1B;AACAA,iBAAW,CAACN,SAAZ,GAAuB,CAAvB;AACAM,iBAAW,CAAChB,QAAZ,GAAuB,IAAvB;AACAgB,iBAAI,YAAJ,GAAgB,IAAhB;;UACEb,YAAW;AACZA;AACF;AACF;AACH;;AA3BuC;AA6BvC,CA7BuC,CA6BvCjB,iBA7BuC;;IA8BrCkC,gCAAoB,YAAqC;WAArCA,8BAAqC;AACxD;AACD;;kBAEU,4BAAqBxB,UAArB,EAAqBJ,MAArB,EAAqB;AACtB,mBAAa,QAAWwB,WAAxB;AAEPA,eAAM,UAAN;AACA,QAAMK,aAAY,IAAGC,kBAAH,CAAoB1B,UAApB,EAAgCoB,WAAhC,CAAlB;AAEA,QAAIO,YAAY,SAAQ,UAAR,CAAQF,UAAR,CAAhB;;QACS,WAAY;AACpBA;AAED;;AACD;AACH;;AAjBA,SAiBCD,gBAjBD;AAmBA,CAlBsB;;IAkBcE,4CAAa/B,MAAb,EAAa;AAI/CN,wCAAYM,MAAZ;;WAAA+B,mBAEEP,aAAMC,aAAY;AADA,sBAAW,KAAX,uBAAqC,IAArC;;;AAEnB;AAES;;oBAEA,0BAAqB;AAC7B,QAAIA,WAAC,GAAa,gBAAlB;;QACE,cAAK;AACL,wBAAO,IAAP;AACD;AAED;;AACA,SAAMA,WAAN,GAAwB,IAAxB;AACA,QAAIV,QAAQ,cAAO,UAAnB;;QACEA,QAAK,OAAU;AACf,wBAAO,IAAP;AACD;AAEM;;AACPU,eAAI,CAAQN,SAAZ,GAAkBJ,YAAlB;;QACEA,QAAK;AACL,wBAAO,IAAP;AACD;AAyBO;;AACR,QAAMH,kBAAgBA,UAAtB;AACA,QAAIqB,gBAAc,GAAKR,uBAAvB;AAEA,SAAIb,UAAJ,GAAI,IAAJ;;QACEqB,gBAAgB,KAAC,eAAcA,+BAAf,GAAe;AAChCA;AACF;AACH;;AA7DoC;CAAA","names":["tslib_1","SubjectSubscriber","Observable","Subscriber","Subscription","ConnectableObservable","_super","source","subjectFactory","_this","_subscribe","subscriber","prototype","getSubject","subject","_subject","isStopped","connect","connection","_connection","subscribe","refCount","connectableObservableDescriptor","operator","value","_refCount","writable","connectableProto","_isComplete","ConnectableSubscriber","destination","connectable","_error","_complete","_unsubscribe","RefCountOperator","refCounter","RefCountSubscriber","subscription","sharedConnection"],"sources":["../../../src/internal/observable/ConnectableObservable.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}